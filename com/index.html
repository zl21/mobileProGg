<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mobilePro</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/index.css">
</head>

<body>
    <div class="wrapper">
        <!-- 
            头部part：
            头部需要保持当前位置一直不变，所以需要用到固定定位，此固定定位参照布局视口，然而由于移动端有许多视口（ios iframe内的fixed会失效），所以通常不采用固定定位，而是使用absolute定位来模拟fixed定位。
         -->
        <div class="header">
            <div class="header_top">
                <!-- logo -->
                <h1 class="logo">
                    <a href="javascript:; ">
                        <img src="images/logo.png" alt="logo">
                    </a>
                </h1>
                <!-- 面包屑导航 -->
                <a href="javascript:;" class="menuBtn"></a>
                <!-- 三个按钮的按钮组 -->
                <div class="btns">
                    <a href="javascript:;" class="search">search</a>
                    <a href="javascript:;">sign-in</a>
                    <a href="###">sign-up</a>
                </div>
            </div>
            <div class="header_bottom">
                <form action="###" method="get">
                    <input type="text" placeholder="Don't touch me！">
                    <input type="submit" value="search">
                </form>
            </div>
            <!-- 蒙版部分(menuBtn展开) -->
            <ul class="mask">
                <li>
                    <a href="###">首页</a>
                </li>
                <li>
                    <a href="###">MV</a>
                </li>
                <li>
                    <a href="###">悦单</a>
                </li>
                <li>
                    <a href="###">V榜</a>
                </li>
                <li>
                    <a href="###">音乐</a>
                </li>
                <li>
                    <a href="###">商城</a>
                </li>
                <li>
                    <a href="###">节目</a>
                </li>
                <li>
                    <a href="###">饭团</a>
                </li>
                <li>
                    <a href="###">咨询</a>
                </li>
                <li>
                    <a href="###">娱乐</a>
                </li>
                <li>
                    <a href="###">APP</a>
                </li>
                <li>
                    <a href="###">升级</a>
                </li>
            </ul>
        </div>
        <div class="main">
            <nav class="nav">
                <ul class="list">
                    <li class="active">
                        <a href="###">首页</a>
                    </li>
                    <li>
                        <a href="###">MV</a>
                    </li>
                    <li>
                        <a href="###">悦单</a>
                    </li>
                    <li>
                        <a href="###">V榜</a>
                    </li>
                    <li>
                        <a href="###">音乐</a>
                    </li>
                    <li>
                        <a href="###">商城</a>
                    </li>
                    <li>
                        <a href="###">节目</a>
                    </li>
                    <li>
                        <a href="###">饭团</a>
                    </li>
                    <li>
                        <a href="###">咨询</a>
                    </li>
                    <li>
                        <a href="###">更新</a>
                    </li>
                    <li>
                        <a href="###">APP</a>
                    </li>
                    <li>
                        <a href="###">影视</a>
                    </li>
                    <li>
                        <a href="###">电影</a>
                    </li>
                    <li>
                        <a href="###">喜欢</a>
                    </li>
                    <li>
                        <a href="###">推荐</a>
                    </li>
                    <li>
                        <a href="###">收藏</a>
                    </li>
                </ul>
            </nav>
            <div class="carousel-wrap" needCarousel needauto>
                <div class="points-wrap"></div>
            </div>
            <section class="tap-wrap">
                <header class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </header>
                <nav class="tap-nav">
                    <a href="###">全部</a>
                    <a href="###">内地</a>
                    <a href="###">港台</a>
                    <a href="###">欧美</a>
                    <a href="###">韩国</a>
                    <a href="###">日本</a>
                    <div class="smallG"></div>
                </nav>
                <div class="tap-content">
                    <div class="tap-loading"></div>
                    <ul>
                        <li>
                            <a href="###">
                                <img src="./images/a.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/b.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/c.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/d.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/e.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/f.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>

            <section class="tap-wrap">
                <header class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </header>
                <nav class="tap-nav">
                    <a href="###">全部</a>
                    <a href="###">内地</a>
                    <a href="###">港台</a>
                    <a href="###">欧美</a>
                    <a href="###">韩国</a>
                    <a href="###">日本</a>
                    <div class="smallG"></div>
                </nav>
                <div class="tap-content">
                    <div class="tap-loading"></div>
                    <ul>
                        <li>
                            <a href="###">
                                <img src="./images/a.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/b.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/c.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/d.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/e.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/f.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>

            <section class="tap-wrap">
                <header class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </header>
                <nav class="tap-nav">
                    <a href="###">全部</a>
                    <a href="###">内地</a>
                    <a href="###">港台</a>
                    <a href="###">欧美</a>
                    <a href="###">韩国</a>
                    <a href="###">日本</a>
                    <div class="smallG"></div>
                </nav>
                <div class="tap-content">
                    <div class="tap-loading"></div>
                    <ul>
                        <li>
                            <a href="###">
                                <img src="./images/a.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/b.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/c.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/d.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/e.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                        <li>
                            <a href="###">
                                <img src="./images/f.jpg" alt="">
                                <span>君に贈る花がないがないがないがないがないがないがないがない</span>
                            </a>
                            <div class="tap-discuss">
                                <span class="left">9176</span>
                                <span class="right">6</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>
        </div>
    </div>

    <!-- 引入适配方案 -->
    <script src="js/rem.js"></script>
    <!-- 引入tools -->
    <script src="js/tools.js"></script>

    <script>
        // 1.阻止默认事件
        document.addEventListener("touchstart", function (ev) {
            ev.preventDefault();
        }, { passive: false });

        // 2.面包屑导航
        menuBtn();
        function menuBtn() {
            let oMenuBtn = document.querySelector(".wrapper .header .header_top .menuBtn");
            let oMask = document.querySelector(".wrapper .header .mask");

            //保存当前蒙版的状态
            let isOpen = false;

            //给按钮绑定点击事件
            oMenuBtn.addEventListener("touchstart", function (ev) {
                // 防止点击menuBtn时时间冒泡到document上从而执行document的绑定事件以至于蒙版不会被打开。
                ev.stopPropagation();

                // 阻止传播以后，就无法使用document上的阻止默认事件了,所以自身要书写也一个阻止默认事件
                ev.preventDefault();

                if (isOpen) {
                    //关闭
                    oMask.style.display = "none";
                    this.classList.remove("active");
                } else {
                    //打开
                    oMask.style.display = "block";
                    this.classList.add("active");
                }
                // 状态改变之后，开关要取反
                isOpen = !isOpen;
            });

            // 当点击页面其他位置的时候，关闭并改变开关的状态
            document.addEventListener("touchstart", function () {
                // 在其他位置点击的时候，如果开关是打开的则关闭，否则不做操作
                if (isOpen) {
                    oMask.style.display = "none";
                    oMenuBtn.classList.remove("active");
                    isOpen = !isOpen;
                }
            }, { passive: false });

            // 点击蒙版时不能让蒙版消失(奇怪的需求)，所以给蒙版也绑定一个点击事件，阻止传播
            oMask.addEventListener("touchstart", function (ev) {
                ev.stopPropagation();
                // 阻止传播后，在蒙版上就无法阻止默认事件了，所以需要手动阻止默认事件
                ev.preventDefault();
            }, { passive: false });
        }

        // 3.搜索栏获取焦点和失去焦点
        changeFoucs();
        function changeFoucs() {
            let oInputSearch = document.querySelector(".wrapper .header .header_bottom form input[type=text]");
            //点击输入框时输入框获取焦点
            oInputSearch.addEventListener("touchstart", function (ev) {
                this.focus();

                //因为会传播到document点击失去焦点的事件上，所以需要阻止传播
                ev.stopPropagation();
                //如果阻止传播以后，可能会有自身的默认事件，需要阻止默认事件
                ev.preventDefault();
            }, { passive: false });

            //点击其他位置时输入框失去焦点
            document.addEventListener("touchstart", function () {
                oInputSearch.blur();
            }, { passive: false })
        }

        // 4.拖动导航栏效果
        drag();
        function drag() {
            let oNav = document.querySelector(".wrapper .main .nav");
            let oList = document.querySelector(".wrapper .main .nav .list");
            let startX = 0;//初始化当前手开始点击的位置
            let elementX = 0;//初始化当前元素的位置
            let translateX = 0;//初始化元素应该最终的位置
            let minX = oNav.offsetWidth - oList.offsetWidth;//定义一个拖动的临界值
            /* list元素的宽度是想由内部的元素撑开的,而不是继承父元素的100%,所以：
                可：<ul class="list" style="position: absolute;">
                也可：<ul class="list" style="float: left;">
             */
            console.log(minX);
            let lastTime = 0; //初始化首touch时的时间戳
            let lastPoint = 0; //首touch时元素的位置
            let timeDis = 0; //time-distance
            let pointDis = 0; //point-distance

            //给nav一个按下事件（想要滑动，首先要按下）
            oNav.addEventListener("touchstart", function (ev) {
                //获取当前事件的touch，touchList的内容
                let touch = ev.changedTouches[0];
                //获取当前手指的位置
                startX = touch.clientX;
                //获取元素现在的位置信息（我们设计使用tanslate来进行位移）
                elementX = tools1.css(oList, "translateX");

                //快速滑屏代码 在刚按下的时候，获取当前的位置和时间戳  以方便计算最后一帧的速度
                lastTime = Date.now();//获取初始时间戳
                lastPoint = tools1.css(oList, "translateX");
            }, { passive: false });

            oNav.addEventListener("touchmove", function (ev) {
                oList.flag = false;//保存当前 是不是橡皮筋  当前不是

                /* 由于受到end事件中transition动画的影响，需要在move时把动画取消 */
                oList.style.transition = "none";
                //获取当前事件的手指头 touchList的内容
                let touch = ev.changedTouches[0];
                //获取当前手指头的位置
                let nowX = touch.clientX;
                //计算差值（如向左拖则disX为负）
                let disX = nowX - startX;//动手后手的位置nowX - 初放手的位置startX
                //给元素的最终位置赋值
                translateX = elementX + disX;
                /* 使得元素每次的有效移动距离都小于上一次，通过乘以一个递减的比例。
                    得出最终位置以后，判断临界值,橡皮筋效果是在临界值设置的,在move的过程中，手指移动的距离正常，但是每一次元素移动的有效距离慢慢变少,虽然每次移动的距离慢慢变少，但是元素也是在走。 
                */
                if (translateX >= 0) {
                    oList.flag = true;
                    //设置一个递减的比例，比例初始值还不能大于1
                    let scale = 300 / (300 + translateX);
                    //计算好比例以后，重新对tranlateX赋值，手指走的差值乘以比例，加上元素原始的位置值
                    translateX = disX * scale + elementX;//(如向左拖时，负小数+elementX = 向左稍微多走一点点)
                } else if (translateX <= minX) {
                    //进入橡皮筋的临界值，改动flag的状态
                    oList.flag = true;
                    let scale = 300 / (300 + translateX);
                    translateX = - disX * scale + elementX;
                }
                //给元素赋值最终位置
                tools1.css(oList, "translateX", translateX);

                /* 快速滑屏效果的实现：
                    首按时获取当前位置及时间戳，便于计算速度。
                    second-touch时也获取位置及时间戳，并将第二次作为第三次的参照，
                    依此……
                    当手放开后，以计算的速度为速度继续滑动一定的距离（仿佛惯性~）
                 */
                let nowTime = Date.now(); //首touch并拖动后的时间戳
                let nowPoint = tools1.css(oList, "translateX");
                timeDis = nowTime - lastTime;
                pointDis = nowPoint - lastPoint;
                //将第n(非最后一次)次touch-move变为参照
                lastTime = nowTime;
                lastPoint = nowPoint;
            }, { passive: false });

            //橡皮筋效果：松手后 弹回去
            oNav.addEventListener("touchend", function () {
                // 快速滑屏（松手后）
                let translateX = tools1.css(oList, 'translateX');// 获取松手瞬间的位置
                // 判断滑屏与否
                if (oList.flag) {
                    if (translateX >= 0) {
                        translateX = 0;
                        oList.style.transition = `all .3s`;
                        tools1.css(oList, "translateX", translateX);
                    } else if (translateX <= minX) {
                        translateX = minX;
                        oList.style.transition = `all .3s`;
                        tools1.css(oList, "translateX", translateX);
                    }
                } else {
                    let speed = pointDis / timeDis; //计算speed
                    console.log(speed); //speed不要不合理
                    speed = Math.abs(speed) < 0.5 ? 0 : speed;

                    /* a little 优化 */
                    let time = Math.abs(speed) * 0.2;//速度决定动画时间，*0.2为了时间短点
                    time = time < 0.8 ? 0.8 : time;//控制time在0.8 ~ 2s之间
                    time = time > 2 ? 2 : time;
                    /* a little 优化结束 */

                    // 确定最终位置
                    let targetX = translateX + speed * 200;
                    console.log(translateX, targetX);
                    /* // 到目标位置的过程
                    oList.style.transition = 'all .5s'; */
                    // 判断targetX临界
                    let bze = '';//使用贝塞尔曲线来实现快速滑屏到临界值后呈现橡皮筋效果

                    if (targetX >= 0) {
                        targetX = 0;
                        /* 快速滑屏到临界值之后呈现橡皮筋效果 */
                        bze = "cubic-bezier(.4,1.52,.7,1.57)";
                    } else if (targetX <= minX) {
                        targetX = minX;
                        bze = "cubic-bezier(.4,1.52,.7,1.57)";
                    }
                    // 到目标位置的过程
                    // oList.style.transition = 'all .5s';
                    oList.style.transition = `all ${time}s ${bze}`;
                    // 将目标位置赋值给元素
                    tools1.css(oList, "translateX", targetX);
                }
                /* 
                                //判断，如果到达临界值以后需要执行松手的内容，否则松手后不执行
                                if (translateX >= 0) {
                                    translateX = 0;
                                } else if (translateX <= minX) {
                                    translateX = minX;
                                }
                                oList.style.transition = "all .3s";
                                tools1.css(oList, "translateX", translateX); 
                */
            });
        }

        // 5.轮播图carousel
        //根据后台数据请求图片
        let arr = ["./images/1.jpg", "./images/2.jpg", "./images/3.jpg", "./images/4.jpg", "./images/5.jpg"];
        carousel(arr);
        //封装轮播图的函数
        function carousel(arr) {
            let oCarouselWrap = document.querySelector(".carousel-wrap");
            //数组长度可能会发生改变（如实现无缝轮播时要添加图片）
            let pointsLength = arr.length;
            //如果用书书写了oCarouselWrap这个元素，则开始轮播图逻辑
            if (oCarouselWrap) {
                //生成轮播图基本结构
                //判断是否是无缝
                let needCarousel = oCarouselWrap.getAttribute("needCarousel");
                //把属性needCarousel 状态改变成布尔值
                needCarousel = needCarousel == null ? false : true;
                console.log(needCarousel);
                //如果是无缝，则把数据的数组改变一下
                if (needCarousel) {
                    arr = arr.concat(arr);
                }
                let oUlNode = document.createElement("ul");
                //生成style标签，用来动态的盛放图片的父级宽度 及 自身的宽度
                let oStyle = document.createElement("style");
                oStyle.innerHTML = `
                .carousel-wrap>.list{
                    width: ${arr.length}00%;
                }
                .carousel-wrap>.list>li{
                    width:${1 / arr.length * 100}%
                }`;
                //把添加好样式的oStyle 添加在head中
                document.head.appendChild(oStyle);
                //给生成的ul添加类名
                oUlNode.classList.add("list");
                //根据后台数据生成内容，也就是li标签及里边的图片
                for (let i = 0; i < arr.length; i++) {
                    oUlNode.innerHTML += `<li>
                        <a href="###">
                            <img src="${arr[i]}" alt="">
                        </a>
                    </li>`;
                }
                // 把生成的li插入到父级中
                oCarouselWrap.appendChild(oUlNode);

                //添加小圆点导航
                let oPointsWrap = document.querySelector(".points-wrap");
                if (oPointsWrap) {
                    //遍历获取数组的真实长度，生成相应数量的小圆点
                    for (let i = 0; i < pointsLength; i++) {
                        if (i == 0) {
                            oPointsWrap.innerHTML += `<span class="active"></span>`;
                        } else {
                            oPointsWrap.innerHTML += `<span></span>`;
                        }
                    }
                }

                // 滑屏效果（Slide to switch pictures.）
                let startX = 0;//初始化手按下时候的位置
                let elementX = 0;//初始化元素起始的位置
                let disX = 0;//初始化每次滑动执行时候的差值
                let translateX = 0;//元素移动后的位置
                let index = 0;//初始化一个下标 保存当前图片的下标
                /*
                防抖的思想:
                    判断用户首次滑屏的方向
                    如果是x轴  则不管用户怎么滑动 都会进行抖动
                    如果是y轴  则不管用户怎么滑动 都不会抖动
                */
                //因防抖需要，重新定义一下新的变量
                let startY = 0;//初始化手按下时候的位置
                let disY = 0;//初始化每次滑动执行时候的差值
                let isFirst = true;//防抖中 判断当前是否是第一次进入
                let isX = true;
                let needAutoTimer = null;//轮播图自动走与否

                oCarouselWrap.addEventListener("touchstart", function (ev) {
                    //当手指按下，清除自动走的计时器动画
                    clearInterval(needAutoTimer);
                    //当按下的时候清除动画
                    oUlNode.style.transition = "none";

                    //当手指头按下的时候，判断是不是无缝
                    if (needCarousel) {
                        let index = tools1.css(oUlNode, "translateX") / document.documentElement.clientWidth;
                        if (-index === 0) {
                            // 因为ul都是的translateX都是负数，所以index可以设置为负的
                            index = - pointsLength;
                        } else if (-index == (arr.length - 1)) {
                            index = -(pointsLength - 1);
                        }
                        tools1.css(oUlNode, "translateX", index * document.documentElement.clientWidth);
                    }
                    //当手按下的时候，获取当前手的位置 及元素位置
                    let touch = ev.changedTouches[0];
                    //获取按下x 和 y的位置 以便判断防抖
                    startX = touch.clientX;
                    startY = touch.clientY;
                    elementX = tools1.css(oUlNode, "translateX");
                    //每次touch都要改变isFirst与isX的状态为true
                    isFirst = true;
                    isX = true;
                }, { passive: false });

                oCarouselWrap.addEventListener("touchmove", function (ev) {
                    if (!isX) {
                        return;//非横向
                    }
                    let touch = ev.changedTouches[0];
                    //当手移动的时获取新的手指的位置
                    let nowX = touch.clientX;
                    let nowY = touch.clientY;
                    //求出手移动的距离
                    disX = nowX - startX;
                    disY = nowY - startY;
                    //求出元素移动后的位置
                    translateX = disX + elementX;

                    //给元素赋值之前的处理：首先判断是不是第一次，如果是第一次则计算出当前的方向
                    if (isFirst) {
                        isFirst = !isFirst;
                        if (Math.abs(disY) > Math.abs(disX)) {
                            //一旦这个时候防止抖动了，那么以后都需要防止抖动
                            // 也就是说以后再也进不来touchmove事件了
                            isX = !isX;
                            // 说明在y轴上滑动，就不让向下执行
                            return;//return 仅仅是首次防抖
                        }
                    }

                    //给元素的位置赋值
                    tools1.css(oUlNode, "translateX", translateX);
                }, { passive: false });

                /* 类似四舍五入的效果，不让图片停留在尴尬的位置 */
                oCarouselWrap.addEventListener("touchend", function (ev) {
                    /* 
                                        // 当用户松手的时候根据disX的差值的正负，得出用户是向前还是向后翻动
                                        if (disX < 0) {
                                            index++;//disX小于0时，左滑，index++即显示后一张
                                        } else if (disX > 0) {
                                            index--;
                                        }
                                        console.log(index);
                                        // 知道下标以后，通过下标计算出ul应该走的位置,下标乘以一张图片的宽度就是 元素的位置
                                        tools1.css(oUlNode, "translateX", - index * document.documentElement.clientWidth);
                     */
                    //当松手的时候，获取此时元素的位置，把此时的位置比上 一个图片的大小
                    //值得到的是一个小数，这个小数的小数点左边的数就是被滑动的那张图，小数点的数字 就是后边那种图被滑动的比例  
                    //我们可以对小数进行四舍五入，如果后边小数点大于5 则说明用户已经翻过了一半 则换下张图，否则不换图
                    index = tools1.css(oUlNode, "translateX") / document.documentElement.clientWidth;
                    index = Math.round(index);

                    arcPoint(index);//调用

                    //当松手的时候，应该继续自动走
                    if (needAuto) {
                        auto();
                    }

                    // 知道下标以后，通过下标计算出ul应该走的位置,下标乘以一张图片的宽度就是 元素的位置
                    tools1.css(oUlNode, "translateX", index * document.documentElement.clientWidth);
                }, { passive: false })

                //获取用户是否书写needauto属性
                let needAuto = oCarouselWrap.getAttribute("needauto");
                // 把needauto属性变成布尔值
                needAuto = needAuto === null ? false : true;
                //判断当needauto为true  则需要自动滚动
                if (needAuto) {
                    //调用自动滚动函数
                    auto();
                }
                //自动滚动函数
                function auto() {
                    //每次添加计时器之前 清掉之前的计时器
                    clearInterval(needAutoTimer);
                    needAutoTimer = setInterval(function () {
                        // 自动走其实就是控制index的加减
                        //在index自动改变之前，需要判断index当前的位置是不是最后一个
                        //如果是 则index不能继续减了，所以需要把index变成前边对应图片的index
                        //index变成之前对应的图片，图片的位置也要改变成之前的图片
                        if (index == 1 - arr.length) {
                            index = 1 - pointsLength;
                            // 在这个改变状态下，不应该让瞬间改变拥有动画
                            oUlNode.style.transition = "none";
                            tools1.css(oUlNode, "translateX", index * document.documentElement.clientWidth);
                        }
                        // 在同步执行代码的过程中，transition设置的值会前后覆盖，所以需要把后边的代码放到异步中执行
                        setTimeout(function () {
                            //因为index是负值，所以自动走应该是index --
                            index--;
                            oUlNode.style.transition = "all 1s";
                            tools1.css(oUlNode, "translateX", index * document.documentElement.clientWidth);

                            //每次移动过后让小圆点跟着走
                            arcPoint(index);
                        }, 0)

                    }, 2000)
                }

                /* point nav 函数：一个参数 */
                function arcPoint(index) {
                    //先判断用户需不需要小圆点
                    if (oPointsWrap) {
                        let oPointsSpan = document.querySelectorAll(".points-wrap span");
                        //在给span新的样式之前，需要把span原来的样式给清空
                        for (let i = 0; i < oPointsSpan.length; i++) {
                            oPointsSpan[i].classList.remove("active");
                        }
                        //根据当前图片的下标，得出需要添加特殊类名的元素
                        //因为index的取值范围是 0-9  而span下标的范围是0-4  所以需要做一些处理
                        // 0-9 对 5取余  得到的范围是 0 - 4  所以可以使用去、取余方法
                        oPointsSpan[-index % pointsLength].classList.add("active");
                    }
                }
            }
        }

        // 6.tap选项卡
        tap();
        function tap() {
            let oTapContents = document.querySelectorAll(".tap-content");
            let oTapWrap = document.querySelector(".tap-wrap");
            //获得父级的宽度，也是每一屏自己的宽度
            let tapW = oTapWrap.offsetWidth;

            // 因为页面中可能出现多个tap  所以循环遍历
            for (let i = 0; i < oTapContents.length; i++) {
                //封装一个move函数，为每一个元素绑定事件
                move(oTapContents[i]);
            }


            function move(oTapContent) {
                //首先把主要内容区域移动进来
                tools1.css(oTapContent, "translateX", -tapW);

                //滑屏逻辑初始化变量
                let startPoint = { x: 0, y: 0 };//初始化手指的位置 分x和y
                let elementPoint = { x: 0, y: 0 };//初始化元素按下时候的位置
                //初始化防抖变量
                let isFirst = true;//初始化是第一次
                let isX = true;//初始化是x轴滑动
                //给oTapContent绑定手指触摸事件
                oTapContent.addEventListener("touchstart", function (ev) {
                    console.log(1)
                    let touch = ev.changedTouches[0];
                    //给手指初始位置赋值
                    startPoint.x = touch.clientX;
                    startPoint.y = touch.clientY;
                    //给元素初始位置赋值
                    elementPoint = {
                        x: tools1.css(oTapContent, "translateX"),
                        y: tools1.css(oTapContent, "translateY"),
                    }
                    //当每次重新按下的时候 需要把 是否是第一次 和 是否是x滑动 变量更新为true
                    isFirst = true;
                    isX = true;
                }, { passive: false });

                //给oTapContent绑定手指滑动事件
                oTapContent.addEventListener("touchmove", function (ev) {
                    let touch = ev.changedTouches[0];
                    let nowPoint = {
                        x: touch.clientX,
                        y: touch.clientY
                    }
                    let dis = {
                        x: nowPoint.x - startPoint.x,
                        y: nowPoint.y - startPoint.y
                    }
                    //防抖代码，只有第一次进入才执行防抖代码
                    if (isFirst) {
                        //当是第一次进入  那么首先取个反
                        isFirst = !isFirst;
                        // 检测第一次执行的move 和 start按下时候位置差 是x滑动还是y滑动
                        if (Math.abs(dis.y) > Math.abs(dis.x)) {
                            //如果在y轴滑动大于x轴 则把isX变成false，下次就无法进入move方法
                            isX = false;
                            //并让函数退出 不能执行下边的赋值代码
                            return;
                        }
                    }

                    tools1.css(oTapContent, "translateX", elementPoint.x + dis.x);
                }, { passive: false });

                //给oTapContent绑定手指抬起事件
                oTapContent.addEventListener("touchend", function (ev) {

                }, { passive: false });
            }
        }

    </script>
</body>

</html>